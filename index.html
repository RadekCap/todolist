<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TodoList</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <div class="container auth-mode loading" id="mainContainer">
        <h1 class="app-header">
            <svg class="app-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="iconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#5AC8FA"/>
                        <stop offset="100%" style="stop-color:#007AFF"/>
                    </linearGradient>
                </defs>
                <circle cx="16" cy="16" r="14" fill="url(#iconGradient)"/>
                <path d="M10 16.5L14 20.5L22 12.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="app-title">TodoList</span>
        </h1>

        <!-- Authentication UI -->
        <div id="authContainer" class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>

            <div id="authMessage"></div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>
                <button type="submit" class="auth-btn">Login</button>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="auth-form">
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required autocomplete="new-password" minlength="6">
                </div>
                <div class="form-group">
                    <label for="signupPasswordConfirm">Confirm Password</label>
                    <input type="password" id="signupPasswordConfirm" required autocomplete="new-password" minlength="6">
                </div>
                <button type="submit" class="auth-btn">Sign Up</button>
            </form>
        </div>

        <!-- App UI (shown after login) -->
        <div id="appContainer" class="app-container">
            <div class="main-content">
                <!-- Sidebar with categories -->
                <div class="sidebar">
                    <!-- GTD Section -->
                    <div class="gtd-section">
                        <ul id="gtdList" class="gtd-list"></ul>
                    </div>

                    <!-- Projects Section (collapsed by default) -->
                    <div class="sidebar-section collapsed" id="projectsSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="false" aria-controls="projectsContent">
                            <h2>Projects</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">â–¼</span>
                        </div>
                        <div class="sidebar-section-content" id="projectsContent">
                            <ul id="projectList" class="project-list"></ul>
                            <div class="add-project-form">
                                <input
                                    type="text"
                                    id="newProjectInput"
                                    class="add-project-input"
                                    placeholder="New project..."
                                    autocomplete="off"
                                >
                                <button id="addProjectBtn" class="add-project-btn">Add Project</button>
                            </div>
                        </div>
                    </div>

                    <!-- Categories Section (collapsed by default) -->
                    <div class="sidebar-section collapsed" id="categoriesSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="false" aria-controls="categoriesContent">
                            <h2>Categories</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">â–¼</span>
                        </div>
                        <div class="sidebar-section-content" id="categoriesContent">
                            <ul id="categoryList" class="category-list"></ul>
                            <div class="add-category-form">
                                <input
                                    type="text"
                                    id="newCategoryInput"
                                    class="add-category-input"
                                    placeholder="New category..."
                                    autocomplete="off"
                                >
                                <button id="addCategoryBtn" class="add-category-btn">Add Category</button>
                            </div>
                        </div>
                    </div>

                    <!-- Contexts Section (collapsed by default) -->
                    <div class="sidebar-section collapsed" id="contextsSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="false" aria-controls="contextsContent">
                            <h2 class="contexts-header">Contexts</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">â–¼</span>
                        </div>
                        <div class="sidebar-section-content" id="contextsContent">
                            <ul id="contextList" class="context-list"></ul>
                            <div class="add-context-form">
                                <input
                                    type="text"
                                    id="newContextInput"
                                    class="add-context-input"
                                    placeholder="@context..."
                                    autocomplete="off"
                                >
                                <button id="addContextBtn" class="add-context-btn">Add Context</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main content area -->
                <div class="content">
                    <button id="openAddTodoModal" class="add-todo-btn">+ Add New Todo</button>

                    <ul id="todoList" class="todo-list"></ul>

                    <div class="stats">
                        <span id="totalTodos">Total: 0</span>
                        <span id="completedTodos">Completed: 0</span>
                        <button id="exportBtn" class="export-btn" aria-label="Export current list">Export</button>
                    </div>
                </div>
            </div>

            <div class="user-header">
                <div class="user-info">
                    <span class="user-display" id="userDisplay"></span>
                    <span class="user-email" id="userEmail"></span>
                </div>
                <div class="user-actions">
                    <button id="lockBtn" class="lock-btn" aria-label="Lock application">ðŸ”’</button>
                    <button id="settingsBtn" class="settings-btn">Settings</button>
                    <button id="logoutBtn" class="logout-btn">Logout</button>
                </div>
            </div>

            <footer class="app-footer">
                <div class="app-version" id="appVersion">
                    Version <span id="versionNumber">0.0.0</span>
                </div>
                <div class="theme-selector">
                    <label for="themeSelect">Theme:</label>
                    <select id="themeSelect" aria-label="Color scheme selector">
                        <option value="glass">Glass</option>
                        <option value="dark">Dark</option>
                        <option value="clear">Clear</option>
                    </select>
                </div>
                <div class="app-footer-links">
                    <a href="https://github.com/RadekCap/todolist" target="_blank" rel="noopener noreferrer">GitHub</a>
                    <a href="https://github.com/RadekCap/todolist/blob/main/VERSION.md" target="_blank" rel="noopener noreferrer">Changelog</a>
                    <a href="https://github.com/RadekCap/todolist/issues/new?labels=feature-request" target="_blank" rel="noopener noreferrer">Request Feature</a>
                    <a href="https://github.com/RadekCap/todolist/issues/new?labels=bug" target="_blank" rel="noopener noreferrer">Report Issue</a>
                </div>
            </footer>
        </div>

        <!-- Add Todo Modal -->
        <div id="addTodoModal" class="modal-overlay">
            <div class="modal modal-wide" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                <div class="modal-header">
                    <h2 id="modalTitle">Add New Todo</h2>
                    <button id="closeModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="addTodoForm" class="modal-form modal-form-split">
                    <div class="modal-form-main">
                        <div class="modal-title-row">
                            <button type="button" id="modalPriorityToggle" class="priority-star" aria-label="Toggle priority" title="Toggle priority">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                            </button>
                            <input
                                type="text"
                                id="modalTodoInput"
                                class="modal-title-input"
                                placeholder="To Do"
                                autocomplete="off"
                                required
                            >
                        </div>
                        <div class="modal-field">
                            <textarea
                                id="modalCommentInput"
                                class="modal-notes-input"
                                placeholder="Notes"
                                rows="6"
                            ></textarea>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" id="modalAddBtn" class="modal-btn modal-btn-primary">Save Changes</button>
                            <button type="button" id="cancelModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        </div>
                    </div>
                    <div class="modal-form-sidebar">
                        <div class="modal-sidebar-field">
                            <label for="modalDueDateInput">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
                                        <path d="M16 2v4M8 2v4M2 10h20"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">due</span>
                            </label>
                            <input type="date" id="modalDueDateInput" class="modal-sidebar-input">
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalPrioritySelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                                        <line x1="4" y1="22" x2="4" y2="15"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">priority</span>
                            </label>
                            <select id="modalPrioritySelect" class="modal-sidebar-select" aria-label="Priority">
                                <option value="">No Priority</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalGtdStatusSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">status</span>
                            </label>
                            <select id="modalGtdStatusSelect" class="modal-sidebar-select" aria-label="GTD Status">
                                <option value="inbox">Inbox</option>
                                <option value="next_action">Next Action</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="waiting_for">Waiting For</option>
                                <option value="someday_maybe">Someday/Maybe</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalProjectSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">project</span>
                            </label>
                            <select id="modalProjectSelect" class="modal-sidebar-select">
                                <option value="">No Project</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalCategorySelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                                        <line x1="7" y1="7" x2="7.01" y2="7"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">category</span>
                            </label>
                            <select id="modalCategorySelect" class="modal-sidebar-select">
                                <option value="">No Category</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalContextSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="10" r="3"/>
                                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">context</span>
                            </label>
                            <select id="modalContextSelect" class="modal-sidebar-select" aria-label="Context">
                                <option value="">No Context</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
                <div class="modal-header">
                    <h2 id="settingsModalTitle">User Settings</h2>
                    <button id="closeSettingsModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="settingsForm" class="modal-form">
                    <div>
                        <label for="usernameInput">Display Name</label>
                        <input
                            type="text"
                            id="usernameInput"
                            placeholder="Enter your display name..."
                            autocomplete="off"
                            maxlength="50"
                        >
                        <small style="color: #999; font-size: 12px; display: block; margin-top: 5px;">
                            This name will be displayed instead of your email. Leave empty to show email.
                        </small>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 15px; margin-top: 15px;">
                        <label>Data Encryption</label>
                        <p style="color: #666; font-size: 13px; margin: 5px 0 10px 0;">
                            Encrypt any existing unencrypted todos and categories. This is a one-time operation.
                        </p>
                        <button type="button" id="migrateDataBtn" class="modal-btn modal-btn-primary" style="width: 100%;">
                            Encrypt Existing Data
                        </button>
                        <div id="migrateStatus" style="margin-top: 10px; font-size: 13px; display: none;"></div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancelSettingsModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        <button type="submit" id="saveSettingsBtn" class="modal-btn modal-btn-primary">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Unlock Modal (for session restore) -->
        <div id="unlockModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="unlockModalTitle">
                <div class="modal-header">
                    <h2 id="unlockModalTitle">Unlock Your Data</h2>
                </div>
                <form id="unlockForm" class="modal-form">
                    <div>
                        <p style="color: #666; margin-bottom: 15px;">
                            Enter your password to decrypt your data. Your password is used locally to unlock your encrypted todos and categories.
                        </p>
                        <label for="unlockEmail">Email</label>
                        <input
                            type="email"
                            id="unlockEmail"
                            autocomplete="username email"
                        >
                    </div>
                    <div>
                        <label for="unlockPassword">Password</label>
                        <input
                            type="password"
                            id="unlockPassword"
                            placeholder="Enter your password..."
                            autocomplete="current-password"
                            required
                        >
                    </div>
                    <div id="unlockError" class="error-message" style="display: none;"></div>
                    <div class="modal-actions">
                        <button type="button" id="unlockLogoutBtn" class="modal-btn modal-btn-secondary">Logout</button>
                        <button type="submit" id="unlockBtn" class="modal-btn modal-btn-primary">Unlock</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script type="module" src="app.js"></script>
</body>
</html>
