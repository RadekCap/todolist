<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TodoList</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <div class="container auth-mode loading" id="mainContainer">

        <!-- Authentication UI -->
        <div id="authContainer" class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>

            <div id="authMessage"></div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>
                <button type="submit" class="auth-btn">Login</button>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="auth-form">
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required autocomplete="new-password" minlength="6">
                </div>
                <div class="form-group">
                    <label for="signupPasswordConfirm">Confirm Password</label>
                    <input type="password" id="signupPasswordConfirm" required autocomplete="new-password" minlength="6">
                </div>
                <button type="submit" class="auth-btn">Sign Up</button>
            </form>
        </div>

        <!-- App UI (shown after login) -->
        <div id="appContainer" class="app-container">
            <div class="main-content">
                <!-- Sidebar with categories -->
                <div class="sidebar">
                    <!-- App Branding -->
                    <div class="sidebar-branding">
                        <svg class="sidebar-app-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="sidebarIconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#5AC8FA"/>
                                    <stop offset="100%" style="stop-color:#007AFF"/>
                                </linearGradient>
                            </defs>
                            <circle cx="16" cy="16" r="14" fill="url(#sidebarIconGradient)"/>
                            <path d="M10 16.5L14 20.5L22 12.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <div class="sidebar-app-info">
                            <span class="sidebar-app-title">TodoList</span>
                            <span class="sidebar-app-version" id="versionNumber">0.0.0</span>
                        </div>
                    </div>

                    <!-- GTD Section -->
                    <div class="gtd-section">
                        <ul id="gtdList" class="gtd-list"></ul>
                    </div>

                    <!-- Projects Section (expanded by default) -->
                    <div class="sidebar-section" id="projectsSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="true" aria-controls="projectsContent">
                            <h2>Projects</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">‚ñº</span>
                        </div>
                        <div class="sidebar-section-content" id="projectsContent">
                            <ul id="projectList" class="project-list"></ul>
                            <div class="add-project-form">
                                <input
                                    type="text"
                                    id="newProjectInput"
                                    class="add-project-input"
                                    placeholder="New project..."
                                    autocomplete="off"
                                >
                                <button id="addProjectBtn" class="add-project-btn">Add Project</button>
                            </div>
                            <button id="manageProjectsBtn" class="manage-projects-btn">Manage Projects</button>
                        </div>
                    </div>

                </div>

                <!-- Resize handle for sidebar -->
                <div class="sidebar-resize-handle" id="sidebarResizeHandle" role="separator" aria-orientation="vertical" aria-label="Resize sidebar"></div>

                <!-- Main content area -->
                <div class="content">
                    <div class="content-toolbar">
                        <!-- Areas Dropdown -->
                        <div class="toolbar-areas-menu" id="toolbarAreasMenu">
                            <button class="toolbar-areas-btn" id="toolbarAreasBtn" aria-haspopup="true" aria-expanded="false">
                                <span class="toolbar-areas-label" id="toolbarAreasLabel">All Areas</span>
                                <span class="toolbar-menu-arrow">‚ñº</span>
                            </button>
                            <div class="toolbar-areas-dropdown" id="toolbarAreasDropdown" role="menu">
                                <button class="toolbar-dropdown-item toolbar-areas-item" data-area-id="all" role="menuitem">
                                    <span class="areas-item-icon">‚ò∞</span>
                                    <span class="areas-item-label">All Areas</span>
                                    <span class="areas-item-shortcut">‚áß0</span>
                                </button>
                                <button class="toolbar-dropdown-item toolbar-areas-item" data-area-id="unassigned" role="menuitem">
                                    <span class="areas-item-icon">üìÅ</span>
                                    <span class="areas-item-label">Unassigned</span>
                                </button>
                                <div class="toolbar-dropdown-divider"></div>
                                <div id="areaListContainer"></div>
                                <div class="toolbar-dropdown-divider" id="areaListDivider"></div>
                                <button class="toolbar-dropdown-item toolbar-areas-action" id="addAreaBtn" role="menuitem">
                                    <span class="areas-item-icon">+</span>
                                    <span class="areas-item-label">Add New Area</span>
                                </button>
                                <button class="toolbar-dropdown-item toolbar-areas-action" id="manageAreasBtn" role="menuitem">
                                    <span class="areas-item-icon">‚öô</span>
                                    <span class="areas-item-label">Manage Areas</span>
                                </button>
                            </div>
                        </div>
                        <button id="openAddTodoModal" class="toolbar-btn add-todo-btn">+ Add Todo</button>
                        <div class="toolbar-search">
                            <input
                                type="text"
                                id="searchInput"
                                class="toolbar-search-input"
                                placeholder="Search..."
                                autocomplete="off"
                            >
                        </div>
                        <div class="toolbar-spacer"></div>
                        <button id="openImportModal" class="toolbar-btn toolbar-btn-secondary">Import</button>
                        <button id="exportBtn" class="toolbar-btn toolbar-btn-secondary" aria-label="Export current list">Export</button>
                        <select id="themeSelect" class="toolbar-theme-select" aria-label="Color scheme selector">
                            <option value="glass">Glass</option>
                            <option value="dark">Dark</option>
                            <option value="clear">Clear</option>
                        </select>
                        <select id="densitySelect" class="toolbar-density-select" aria-label="Display density selector">
                            <option value="comfortable">Comfortable</option>
                            <option value="compact">Compact</option>
                        </select>
                        <div class="toolbar-user-menu" id="toolbarUserMenu">
                            <button class="toolbar-user-btn" id="toolbarUserBtn" aria-haspopup="true" aria-expanded="false">
                                <span class="toolbar-username" id="toolbarUsername"></span>
                                <span class="toolbar-menu-arrow">‚ñº</span>
                            </button>
                            <div class="toolbar-dropdown" id="toolbarDropdown" role="menu">
                                <button id="settingsBtn" class="toolbar-dropdown-item" role="menuitem">Settings</button>
                                <button id="refreshBtn" class="toolbar-dropdown-item" role="menuitem">Refresh</button>
                                <button id="lockBtn" class="toolbar-dropdown-item" role="menuitem">Lock</button>
                                <div class="toolbar-dropdown-divider"></div>
                                <button id="logoutBtn" class="toolbar-dropdown-item toolbar-dropdown-item-danger" role="menuitem">Logout</button>
                                <div class="toolbar-dropdown-divider"></div>
                                <a href="https://github.com/RadekCap/todolist" target="_blank" rel="noopener noreferrer" class="toolbar-dropdown-item toolbar-dropdown-link" role="menuitem">GitHub</a>
                                <a href="https://github.com/RadekCap/todolist/releases/latest" target="_blank" rel="noopener noreferrer" class="toolbar-dropdown-item toolbar-dropdown-link" role="menuitem">Changelog</a>
                                <a href="https://github.com/RadekCap/todolist/issues/new?labels=feature-request" target="_blank" rel="noopener noreferrer" class="toolbar-dropdown-item toolbar-dropdown-link" role="menuitem">Request Feature</a>
                                <a href="https://github.com/RadekCap/todolist/issues/new?labels=bug" target="_blank" rel="noopener noreferrer" class="toolbar-dropdown-item toolbar-dropdown-link" role="menuitem">Report Issue</a>
                            </div>
                        </div>
                    </div>

                    <div id="areaHeader" class="area-header" style="display: none;">
                        <span class="area-header-color"></span>
                        <span class="area-header-name"></span>
                    </div>

                    <!-- Selection Bar (appears when todos are selected) -->
                    <div id="selectionBar" class="selection-bar">
                        <div class="selection-bar-left">
                            <span id="selectionCount" class="selection-count">0 selected</span>
                            <button id="selectAllBtn" class="selection-bar-btn selection-bar-btn-secondary">Select All</button>
                            <button id="clearSelectionBtn" class="selection-bar-btn selection-bar-btn-secondary">Clear</button>
                        </div>
                        <div class="selection-bar-right">
                            <button id="completeSelectedBtn" class="selection-bar-btn selection-bar-btn-success">Complete</button>
                            <button id="deleteSelectedBtn" class="selection-bar-btn selection-bar-btn-danger">Delete</button>
                            <select id="selectionGtdStatusSelect" class="selection-bar-select" aria-label="Change GTD Status">
                                <option value="">Set Status...</option>
                                <option value="inbox">Inbox</option>
                                <option value="next_action">Next Action</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="waiting_for">Waiting For</option>
                                <option value="someday_maybe">Someday/Maybe</option>
                                <option value="done">Done</option>
                            </select>
                            <select id="selectionProjectSelect" class="selection-bar-select" aria-label="Change Project">
                                <option value="">Move to Project...</option>
                            </select>
                            <select id="selectionPrioritySelect" class="selection-bar-select" aria-label="Change Priority">
                                <option value="">Set Priority...</option>
                            </select>
                        </div>
                    </div>

                    <ul id="todoList" class="todo-list"></ul>
                </div>
            </div>


        </div>

        <!-- Add Todo Modal -->
        <div id="addTodoModal" class="modal-overlay">
            <div class="modal modal-wide" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                <div class="modal-header">
                    <h2 id="modalTitle">Add New Todo</h2>
                    <button id="closeModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="addTodoForm" class="modal-form modal-form-split">
                    <div class="modal-form-main">
                        <div class="modal-title-row">
                            <button type="button" id="modalPriorityToggle" class="priority-star" aria-label="Toggle priority" title="Toggle priority">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                </svg>
                            </button>
                            <input
                                type="text"
                                id="modalTodoInput"
                                class="modal-title-input"
                                placeholder="To Do"
                                autocomplete="off"
                                required
                            >
                        </div>
                        <div class="modal-field">
                            <textarea
                                id="modalCommentInput"
                                class="modal-notes-input"
                                placeholder="Notes"
                                rows="6"
                            ></textarea>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" id="modalAddBtn" class="modal-btn modal-btn-primary">Save Changes</button>
                            <button type="button" id="cancelModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        </div>
                    </div>
                    <div class="modal-form-sidebar">
                        <!-- Tab buttons -->
                        <div class="modal-tabs">
                            <button type="button" class="modal-tab active" data-tab="details">Details</button>
                            <button type="button" class="modal-tab" data-tab="repeat">Repeat</button>
                        </div>

                        <!-- Details tab panel -->
                        <div class="modal-tab-panel active" data-panel="details">
                        <div class="modal-sidebar-field">
                            <label for="modalDueDateInput">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
                                        <path d="M16 2v4M8 2v4M2 10h20"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">due</span>
                            </label>
                            <input type="date" id="modalDueDateInput" class="modal-sidebar-input">
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalPrioritySelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                                        <line x1="4" y1="22" x2="4" y2="15"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">priority</span>
                            </label>
                            <select id="modalPrioritySelect" class="modal-sidebar-select" aria-label="Priority">
                                <option value="">No Priority</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalGtdStatusSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">status</span>
                            </label>
                            <select id="modalGtdStatusSelect" class="modal-sidebar-select" aria-label="GTD Status">
                                <option value="inbox">Inbox</option>
                                <option value="next_action">Next Action</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="waiting_for">Waiting For</option>
                                <option value="someday_maybe">Someday/Maybe</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalProjectSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">project</span>
                            </label>
                            <select id="modalProjectSelect" class="modal-sidebar-select">
                                <option value="">No Project</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalCategorySelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                                        <line x1="7" y1="7" x2="7.01" y2="7"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">category</span>
                            </label>
                            <select id="modalCategorySelect" class="modal-sidebar-select">
                                <option value="">No Category</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="modalContextSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="10" r="3"/>
                                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">context</span>
                            </label>
                            <select id="modalContextSelect" class="modal-sidebar-select" aria-label="Context">
                                <option value="">No Context</option>
                            </select>
                        </div>
                        </div>

                        <!-- Repeat tab panel -->
                        <div class="modal-tab-panel" data-panel="repeat">
                        <div class="modal-sidebar-field">
                            <label for="modalRepeatSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="17 1 21 5 17 9"/>
                                        <path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                                        <polyline points="7 23 3 19 7 15"/>
                                        <path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">repeat</span>
                            </label>
                            <select id="modalRepeatSelect" class="modal-sidebar-select" aria-label="Repeat">
                                <option value="none">Does not repeat</option>
                                <option value="daily">Daily</option>
                                <option value="weekdays">Weekdays (Mon-Fri)</option>
                                <option value="weekends">Weekends (Sat-Sun)</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>

                        <div id="recurrenceOptions" class="recurrence-options" style="display: none;">
                            <div class="recurrence-interval">
                                <label>Every</label>
                                <input type="number" id="recurrenceInterval" class="recurrence-interval-input" value="1" min="1" max="365">
                                <span id="recurrenceIntervalLabel">day(s)</span>
                            </div>

                            <div id="weekdayOptions" class="recurrence-weekdays" style="display: none;">
                                <label>On:</label>
                                <div class="weekday-checkboxes">
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="1"><span>M</span></label>
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="2"><span>T</span></label>
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="3"><span>W</span></label>
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="4"><span>T</span></label>
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="5"><span>F</span></label>
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="6"><span>S</span></label>
                                    <label class="weekday-checkbox"><input type="checkbox" name="weekday" value="0"><span>S</span></label>
                                </div>
                            </div>

                            <div id="monthlyOptions" class="recurrence-monthly" style="display: none;">
                                <label>On the:</label>
                                <div class="monthly-selects">
                                    <select id="recurrenceOrdinal" class="recurrence-select-small">
                                        <option value="1">1st</option>
                                        <option value="2">2nd</option>
                                        <option value="3">3rd</option>
                                        <option value="4">4th</option>
                                        <option value="5">5th</option>
                                        <option value="-1">Last</option>
                                    </select>
                                    <select id="recurrenceDayType" class="recurrence-select-small">
                                        <option value="day_of_month">day</option>
                                        <option value="weekday">weekday</option>
                                        <option value="last_day">last day</option>
                                    </select>
                                </div>
                                <div id="weekdaySelect" class="monthly-weekday" style="display: none;">
                                    <select id="recurrenceWeekday" class="recurrence-select-small">
                                        <option value="0">Sunday</option>
                                        <option value="1">Monday</option>
                                        <option value="2">Tuesday</option>
                                        <option value="3">Wednesday</option>
                                        <option value="4">Thursday</option>
                                        <option value="5">Friday</option>
                                        <option value="6">Saturday</option>
                                    </select>
                                </div>
                            </div>

                            <div id="yearlyOptions" class="recurrence-yearly" style="display: none;">
                                <label>In:</label>
                                <select id="recurrenceMonth" class="recurrence-select-small">
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>

                            <div class="recurrence-end">
                                <label>Ends:</label>
                                <select id="recurrenceEndType" class="recurrence-select-small">
                                    <option value="never">Never</option>
                                    <option value="on_date">On date</option>
                                    <option value="after_count">After</option>
                                </select>
                                <input type="date" id="recurrenceEndDate" class="recurrence-end-date" style="display: none;">
                                <div id="recurrenceEndCountWrapper" class="recurrence-end-count" style="display: none;">
                                    <input type="number" id="recurrenceEndCount" class="recurrence-count-input" value="10" min="1" max="999">
                                    <span>occurrences</span>
                                </div>
                            </div>

                            <div class="recurrence-preview">
                                <label>Next occurrences:</label>
                                <ul id="recurrencePreviewList" class="recurrence-preview-list"></ul>
                            </div>
                        </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Import Modal -->
        <div id="importModal" class="modal-overlay">
            <div class="modal modal-wide" role="dialog" aria-modal="true" aria-labelledby="importModalTitle">
                <div class="modal-header">
                    <h2 id="importModalTitle">Import Todos</h2>
                    <button id="closeImportModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="importForm" class="modal-form modal-form-split">
                    <div class="modal-form-main">
                        <div class="modal-field">
                            <label for="importTextarea" class="import-label">
                                Paste your todos below (one per line)
                            </label>
                            <textarea
                                id="importTextarea"
                                class="import-textarea"
                                placeholder="Buy groceries&#10;Call dentist&#10;Review project proposal&#10;Send invoice"
                                rows="12"
                                required
                            ></textarea>
                            <small class="import-hint">Empty lines will be ignored. Each line becomes a separate todo.</small>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" id="importBtn" class="modal-btn modal-btn-primary">Import Todos</button>
                            <button type="button" id="cancelImportModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        </div>
                    </div>
                    <div class="modal-form-sidebar">
                        <p class="import-sidebar-title">Apply to all imported items:</p>
                        <div class="modal-sidebar-field">
                            <label for="importGtdStatusSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">status</span>
                            </label>
                            <select id="importGtdStatusSelect" class="modal-sidebar-select" aria-label="GTD Status">
                                <option value="inbox">Inbox</option>
                                <option value="next_action">Next Action</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="waiting_for">Waiting For</option>
                                <option value="someday_maybe">Someday/Maybe</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="importProjectSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">project</span>
                            </label>
                            <select id="importProjectSelect" class="modal-sidebar-select">
                                <option value="">No Project</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="importCategorySelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                                        <line x1="7" y1="7" x2="7.01" y2="7"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">category</span>
                            </label>
                            <select id="importCategorySelect" class="modal-sidebar-select">
                                <option value="">No Category</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="importContextSelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="10" r="3"/>
                                        <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">context</span>
                            </label>
                            <select id="importContextSelect" class="modal-sidebar-select" aria-label="Context">
                                <option value="">No Context</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="importPrioritySelect">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                                        <line x1="4" y1="22" x2="4" y2="15"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">priority</span>
                            </label>
                            <select id="importPrioritySelect" class="modal-sidebar-select" aria-label="Priority">
                                <option value="">No Priority</option>
                            </select>
                        </div>
                        <div class="modal-sidebar-field">
                            <label for="importDueDateInput">
                                <span class="modal-field-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
                                        <path d="M16 2v4M8 2v4M2 10h20"/>
                                    </svg>
                                </span>
                                <span class="modal-field-label">due date</span>
                            </label>
                            <input type="date" id="importDueDateInput" class="modal-sidebar-input">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
                <div class="modal-header">
                    <h2 id="settingsModalTitle">User Settings</h2>
                    <button id="closeSettingsModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="settingsForm" class="modal-form">
                    <div>
                        <label for="usernameInput">Display Name</label>
                        <input
                            type="text"
                            id="usernameInput"
                            placeholder="Enter your display name..."
                            autocomplete="off"
                            maxlength="50"
                        >
                        <small style="color: #999; font-size: 12px; display: block; margin-top: 5px;">
                            This name will be displayed instead of your email. Leave empty to show email.
                        </small>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 15px; margin-top: 15px;">
                        <label>Data Encryption</label>
                        <p style="color: #666; font-size: 13px; margin: 5px 0 10px 0;">
                            Encrypt any existing unencrypted todos and categories. This is a one-time operation.
                        </p>
                        <button type="button" id="migrateDataBtn" class="modal-btn modal-btn-primary" style="width: 100%;">
                            Encrypt Existing Data
                        </button>
                        <div id="migrateStatus" style="margin-top: 10px; font-size: 13px; display: none;"></div>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 15px; margin-top: 15px;">
                        <label>Email Notifications</label>
                        <p style="color: #666; font-size: 13px; margin: 5px 0 10px 0;">
                            Receive daily email summaries of your scheduled todos.
                        </p>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <input type="checkbox" id="emailNotificationsEnabled" style="width: auto; margin: 0;">
                            <label for="emailNotificationsEnabled" style="margin: 0; font-weight: normal;">Enable daily email notifications</label>
                        </div>
                        <div id="notificationSettingsDetails" style="display: none; margin-top: 15px;">
                            <div style="margin-bottom: 10px;">
                                <label for="notificationTime" style="display: block; margin-bottom: 5px;">Send at:</label>
                                <select id="notificationTime" class="modal-sidebar-select" style="width: 100%;">
                                    <option value="06:00:00">6:00 AM</option>
                                    <option value="07:00:00">7:00 AM</option>
                                    <option value="08:00:00" selected>8:00 AM</option>
                                    <option value="09:00:00">9:00 AM</option>
                                    <option value="10:00:00">10:00 AM</option>
                                    <option value="12:00:00">12:00 PM</option>
                                    <option value="18:00:00">6:00 PM</option>
                                    <option value="20:00:00">8:00 PM</option>
                                    <option value="21:00:00">9:00 PM</option>
                                </select>
                            </div>
                            <div>
                                <label for="timezoneSelect" style="display: block; margin-bottom: 5px;">Timezone:</label>
                                <select id="timezoneSelect" class="modal-sidebar-select" style="width: 100%;"></select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancelSettingsModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        <button type="submit" id="saveSettingsBtn" class="modal-btn modal-btn-primary">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manage Areas Modal -->
        <div id="manageAreasModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="manageAreasModalTitle">
                <div class="modal-header">
                    <h2 id="manageAreasModalTitle">Manage Areas</h2>
                    <button id="closeManageAreasModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-form">
                    <div class="manage-areas-add">
                        <input
                            type="text"
                            id="newAreaInput"
                            placeholder="New area name..."
                            autocomplete="off"
                            maxlength="50"
                        >
                        <button type="button" id="addNewAreaBtn" class="modal-btn modal-btn-primary">Add</button>
                    </div>
                    <ul id="manageAreasList" class="manage-areas-list"></ul>
                    <div class="modal-actions">
                        <button type="button" id="closeManageAreasModalBtn" class="modal-btn modal-btn-secondary">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Projects Modal -->
        <div id="manageProjectsModal" class="modal-overlay">
            <div class="modal modal-wide" role="dialog" aria-modal="true" aria-labelledby="manageProjectsModalTitle">
                <div class="modal-header">
                    <h2 id="manageProjectsModalTitle">Manage Projects</h2>
                    <button id="closeManageProjectsModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <div class="modal-form">
                    <div class="manage-projects-add">
                        <input
                            type="text"
                            id="newProjectModalInput"
                            placeholder="New project name..."
                            autocomplete="off"
                            maxlength="100"
                        >
                        <button type="button" id="addNewProjectBtn" class="modal-btn modal-btn-primary">Add</button>
                    </div>
                    <ul id="manageProjectsList" class="manage-projects-list"></ul>
                    <div class="modal-actions">
                        <button type="button" id="closeManageProjectsModalBtn" class="modal-btn modal-btn-secondary">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (outside mainContainer to avoid backdrop-filter affecting fixed positioning) -->

    <!-- Unlock Modal (for session restore) -->
    <div id="unlockModal" class="modal-overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="unlockModalTitle">
            <div class="modal-header">
                <h2 id="unlockModalTitle">Unlock Your Data</h2>
            </div>
            <form id="unlockForm" class="modal-form">
                <div>
                    <p class="unlock-description">
                        Enter your password to decrypt your data. Your password is used locally to unlock your encrypted todos and categories.
                    </p>
                    <label for="unlockEmail">Email</label>
                    <input
                        type="email"
                        id="unlockEmail"
                        autocomplete="username email"
                    >
                </div>
                <div>
                    <label for="unlockPassword">Password</label>
                    <input
                        type="password"
                        id="unlockPassword"
                        placeholder="Enter your password..."
                        autocomplete="current-password"
                        required
                    >
                </div>
                <div id="unlockError" class="error-message" style="display: none;"></div>
                <div class="modal-actions">
                    <button type="button" id="unlockLogoutBtn" class="modal-btn modal-btn-secondary">Logout</button>
                    <button type="submit" id="unlockBtn" class="modal-btn modal-btn-primary">Unlock</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help Modal -->
    <div id="keyboardShortcutsModal" class="modal-overlay">
        <div class="modal keyboard-shortcuts-modal" role="dialog" aria-modal="true" aria-labelledby="keyboardShortcutsModalTitle">
            <div class="modal-header">
                <h2 id="keyboardShortcutsModalTitle">Keyboard Shortcuts</h2>
                <button id="closeKeyboardShortcutsModal" class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="keyboard-shortcuts-content">
                <div class="shortcuts-section">
                    <h3>GTD Views</h3>
                    <ul class="shortcuts-list">
                        <li><kbd>1</kbd> <span>Inbox</span></li>
                        <li><kbd>2</kbd> <span>Next</span></li>
                        <li><kbd>3</kbd> <span>Scheduled</span></li>
                        <li><kbd>4</kbd> <span>Waiting</span></li>
                        <li><kbd>5</kbd> <span>Someday</span></li>
                        <li><kbd>6</kbd> <span>Done</span></li>
                        <li><kbd>0</kbd> <span>All</span></li>
                    </ul>
                </div>
                <div class="shortcuts-section">
                    <h3>Areas</h3>
                    <ul class="shortcuts-list">
                        <li><kbd>Shift</kbd> + <kbd>0</kbd> <span>All Areas</span></li>
                        <li><kbd>Shift</kbd> + <kbd>1-9</kbd> <span>Switch to Area</span></li>
                    </ul>
                </div>
                <div class="shortcuts-section">
                    <h3>Actions</h3>
                    <ul class="shortcuts-list">
                        <li><kbd>n</kbd> <span>New Todo</span></li>
                        <li><kbd>/</kbd> <span>Focus Search</span></li>
                        <li><kbd>Esc</kbd> <span>Close Modal / Clear Search</span></li>
                        <li><kbd>?</kbd> <span>Show This Help</span></li>
                    </ul>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" id="closeKeyboardShortcutsModalBtn" class="modal-btn modal-btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
