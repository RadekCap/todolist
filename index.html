<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TodoList</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <div class="container auth-mode loading" id="mainContainer">
        <h1 class="app-header">
            <svg class="app-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="iconGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#5AC8FA"/>
                        <stop offset="100%" style="stop-color:#007AFF"/>
                    </linearGradient>
                </defs>
                <circle cx="16" cy="16" r="14" fill="url(#iconGradient)"/>
                <path d="M10 16.5L14 20.5L22 12.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="app-title">TodoList</span>
        </h1>

        <!-- Authentication UI -->
        <div id="authContainer" class="auth-container">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>

            <div id="authMessage"></div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>
                <button type="submit" class="auth-btn">Login</button>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="auth-form">
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required autocomplete="new-password" minlength="6">
                </div>
                <div class="form-group">
                    <label for="signupPasswordConfirm">Confirm Password</label>
                    <input type="password" id="signupPasswordConfirm" required autocomplete="new-password" minlength="6">
                </div>
                <button type="submit" class="auth-btn">Sign Up</button>
            </form>
        </div>

        <!-- App UI (shown after login) -->
        <div id="appContainer" class="app-container">
            <div class="main-content">
                <!-- Sidebar with categories -->
                <div class="sidebar">
                    <!-- GTD Section -->
                    <div class="gtd-section">
                        <ul id="gtdList" class="gtd-list"></ul>
                    </div>

                    <!-- Projects Section (collapsed by default) -->
                    <div class="sidebar-section collapsed" id="projectsSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="false" aria-controls="projectsContent">
                            <h2>Projects</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">‚ñº</span>
                        </div>
                        <div class="sidebar-section-content" id="projectsContent">
                            <ul id="projectList" class="project-list"></ul>
                            <div class="add-project-form">
                                <input
                                    type="text"
                                    id="newProjectInput"
                                    class="add-project-input"
                                    placeholder="New project..."
                                    autocomplete="off"
                                >
                                <button id="addProjectBtn" class="add-project-btn">Add Project</button>
                            </div>
                        </div>
                    </div>

                    <!-- Categories Section (collapsed by default) -->
                    <div class="sidebar-section collapsed" id="categoriesSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="false" aria-controls="categoriesContent">
                            <h2>Categories</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">‚ñº</span>
                        </div>
                        <div class="sidebar-section-content" id="categoriesContent">
                            <ul id="categoryList" class="category-list"></ul>
                            <div class="add-category-form">
                                <input
                                    type="text"
                                    id="newCategoryInput"
                                    class="add-category-input"
                                    placeholder="New category..."
                                    autocomplete="off"
                                >
                                <button id="addCategoryBtn" class="add-category-btn">Add Category</button>
                            </div>
                        </div>
                    </div>

                    <!-- Contexts Section (collapsed by default) -->
                    <div class="sidebar-section collapsed" id="contextsSection">
                        <div class="sidebar-section-header" role="button" aria-expanded="false" aria-controls="contextsContent">
                            <h2 class="contexts-header">Contexts</h2>
                            <span class="sidebar-section-toggle" aria-hidden="true">‚ñº</span>
                        </div>
                        <div class="sidebar-section-content" id="contextsContent">
                            <ul id="contextList" class="context-list"></ul>
                            <div class="add-context-form">
                                <input
                                    type="text"
                                    id="newContextInput"
                                    class="add-context-input"
                                    placeholder="@context..."
                                    autocomplete="off"
                                >
                                <button id="addContextBtn" class="add-context-btn">Add Context</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main content area -->
                <div class="content">
                    <button id="openAddTodoModal" class="add-todo-btn">+ Add New Todo</button>

                    <ul id="todoList" class="todo-list"></ul>

                    <div class="stats">
                        <span id="totalTodos">Total: 0</span>
                        <span id="completedTodos">Completed: 0</span>
                    </div>
                </div>
            </div>

            <div class="user-header">
                <div class="user-info">
                    <span class="user-display" id="userDisplay"></span>
                    <span class="user-email" id="userEmail"></span>
                </div>
                <div class="user-actions">
                    <button id="lockBtn" class="lock-btn" aria-label="Lock application">üîí</button>
                    <button id="settingsBtn" class="settings-btn">Settings</button>
                    <button id="logoutBtn" class="logout-btn">Logout</button>
                </div>
            </div>

            <footer class="app-footer">
                <div class="app-version" id="appVersion">
                    Version <span id="versionNumber">0.0.0</span>
                </div>
                <div class="theme-selector">
                    <label for="themeSelect">Theme:</label>
                    <select id="themeSelect" aria-label="Color scheme selector">
                        <option value="purple">Purple</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="orange">Orange</option>
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                        <option value="glass">Glass</option>
                    </select>
                </div>
                <div class="app-footer-links">
                    <a href="https://github.com/RadekCap/todolist" target="_blank" rel="noopener noreferrer">GitHub</a>
                    <a href="https://github.com/RadekCap/todolist/blob/main/VERSION.md" target="_blank" rel="noopener noreferrer">Changelog</a>
                    <a href="https://github.com/RadekCap/todolist/issues/new?labels=feature-request" target="_blank" rel="noopener noreferrer">Request Feature</a>
                    <a href="https://github.com/RadekCap/todolist/issues/new?labels=bug" target="_blank" rel="noopener noreferrer">Report Issue</a>
                </div>
            </footer>
        </div>

        <!-- Add Todo Modal -->
        <div id="addTodoModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
                <div class="modal-header">
                    <h2 id="modalTitle">Add New Todo</h2>
                    <button id="closeModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="addTodoForm" class="modal-form">
                    <div class="form-columns">
                        <!-- Left Column: Task -->
                        <div class="form-column form-column-task">
                            <fieldset class="form-section form-section-task">
                                <legend class="form-section-title"><span class="section-icon">‚úèÔ∏è</span> Task</legend>
                                <div class="form-field form-field-title">
                                    <label for="modalTodoInput"><span class="label-icon">üìù</span> What needs to be done?</label>
                                    <input
                                        type="text"
                                        id="modalTodoInput"
                                        class="input-title"
                                        placeholder="Enter todo description..."
                                        autocomplete="off"
                                        required
                                    >
                                </div>
                                <div class="form-field">
                                    <label for="modalCommentInput"><span class="label-icon">üìã</span> Notes</label>
                                    <textarea
                                        id="modalCommentInput"
                                        placeholder="Add additional notes or details..."
                                        maxlength="1024"
                                        rows="6"
                                    ></textarea>
                                </div>
                            </fieldset>
                        </div>

                        <!-- Right Column: Organization & Planning -->
                        <div class="form-column">
                            <fieldset class="form-section">
                                <legend class="form-section-title"><span class="section-icon">üìÅ</span> Organization</legend>
                                <div class="form-field">
                                    <label for="modalCategorySelect"><span class="label-icon">üè∑Ô∏è</span> Category</label>
                                    <select id="modalCategorySelect">
                                        <option value="">No Category</option>
                                    </select>
                                </div>
                                <div class="form-field">
                                    <label for="modalProjectSelect"><span class="label-icon">üìÇ</span> Project</label>
                                    <select id="modalProjectSelect">
                                        <option value="">No Project</option>
                                    </select>
                                </div>
                            </fieldset>

                            <fieldset class="form-section">
                                <legend class="form-section-title"><span class="section-icon">üìÖ</span> Planning</legend>
                                <div class="form-field">
                                    <label for="modalGtdStatusSelect"><span class="label-icon">üì•</span> Status</label>
                                    <select id="modalGtdStatusSelect" aria-label="GTD Status">
                                        <option value="inbox">Inbox</option>
                                        <option value="next_action">Next Action</option>
                                        <option value="waiting_for">Waiting For</option>
                                        <option value="someday_maybe">Someday/Maybe</option>
                                        <option value="done">Done</option>
                                    </select>
                                </div>
                                <div class="form-field">
                                    <label for="modalPrioritySelect"><span class="label-icon">üî•</span> Priority</label>
                                    <select id="modalPrioritySelect" aria-label="Priority">
                                        <option value="">No Priority</option>
                                    </select>
                                </div>
                                <div class="form-field">
                                    <label for="modalContextSelect"><span class="label-icon">üìç</span> Context</label>
                                    <select id="modalContextSelect" aria-label="Context">
                                        <option value="">No Context</option>
                                    </select>
                                </div>
                                <div class="form-field">
                                    <label for="modalDueDateInput"><span class="label-icon">üóìÔ∏è</span> Due Date</label>
                                    <input
                                        type="date"
                                        id="modalDueDateInput"
                                    >
                                </div>
                            </fieldset>
                        </div>
                    </div>

                    <div class="create-more-option">
                        <label class="checkbox-label">
                            <input type="checkbox" id="createMoreCheckbox">
                            <span>Create more</span>
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancelModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        <button type="submit" id="modalAddBtn" class="modal-btn modal-btn-primary">Add Todo</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
                <div class="modal-header">
                    <h2 id="settingsModalTitle">User Settings</h2>
                    <button id="closeSettingsModal" class="modal-close" aria-label="Close modal">&times;</button>
                </div>
                <form id="settingsForm" class="modal-form">
                    <div>
                        <label for="usernameInput">Display Name</label>
                        <input
                            type="text"
                            id="usernameInput"
                            placeholder="Enter your display name..."
                            autocomplete="off"
                            maxlength="50"
                        >
                        <small style="color: #999; font-size: 12px; display: block; margin-top: 5px;">
                            This name will be displayed instead of your email. Leave empty to show email.
                        </small>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 15px; margin-top: 15px;">
                        <label>Data Encryption</label>
                        <p style="color: #666; font-size: 13px; margin: 5px 0 10px 0;">
                            Encrypt any existing unencrypted todos and categories. This is a one-time operation.
                        </p>
                        <button type="button" id="migrateDataBtn" class="modal-btn modal-btn-primary" style="width: 100%;">
                            Encrypt Existing Data
                        </button>
                        <div id="migrateStatus" style="margin-top: 10px; font-size: 13px; display: none;"></div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" id="cancelSettingsModal" class="modal-btn modal-btn-secondary">Cancel</button>
                        <button type="submit" id="saveSettingsBtn" class="modal-btn modal-btn-primary">Save Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Unlock Modal (for session restore) -->
        <div id="unlockModal" class="modal-overlay">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="unlockModalTitle">
                <div class="modal-header">
                    <h2 id="unlockModalTitle">Unlock Your Data</h2>
                </div>
                <form id="unlockForm" class="modal-form">
                    <div>
                        <p style="color: #666; margin-bottom: 15px;">
                            Enter your password to decrypt your data. Your password is used locally to unlock your encrypted todos and categories.
                        </p>
                        <label for="unlockEmail">Email</label>
                        <input
                            type="email"
                            id="unlockEmail"
                            autocomplete="username email"
                        >
                    </div>
                    <div>
                        <label for="unlockPassword">Password</label>
                        <input
                            type="password"
                            id="unlockPassword"
                            placeholder="Enter your password..."
                            autocomplete="current-password"
                            required
                        >
                    </div>
                    <div id="unlockError" class="error-message" style="display: none;"></div>
                    <div class="modal-actions">
                        <button type="button" id="unlockLogoutBtn" class="modal-btn modal-btn-secondary">Logout</button>
                        <button type="submit" id="unlockBtn" class="modal-btn modal-btn-primary">Unlock</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script type="module" src="app.js"></script>
</body>
</html>
